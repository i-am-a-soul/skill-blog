# 头部字段

报文头部的结构和我们熟悉的`JSON`对象的结构非常类似，都是“`key: value`”的形式，中间以冒号相隔，其中字段名不区分大小写。头部字段类型分为`4`种，分别介绍如下。

## 通用头部字段

请求报文和响应报文都会用到。重要的头部字段有以下几个。

### `cache-control`

这个字段是用来控制缓存的，它可以接收多个参数，参数之间以逗号“`,`”分隔。虽然它是通用字段，但是请求头部和响应头部使用的参数值还是略有不同。先来看请求报文和响应报文共用的值。

- `no-cache`：`no-cache`值表明强制使用最新的值而不使用缓存值。如果请求头部包含`no-cache`，则表示客户端不接收缓存过的响应，缓存服务器必须把客户端请求转发给源服务器。如果响应中包含`no-cache`，那么缓存服务器不能对响应资源进行缓存。
- `no-store`：当使用`no-store`时表示对应的报文中包含机密信息，也就意味着不应该缓存当前内容。
- `no-transform`：缓存不能改变实体的媒体类型，能防止缓存服务器压缩图片等操作。
- `max-age`：缓存有效期，单位为秒。客户端请求中包含`max-age`时，如果缓存资源的缓存时间比指定时间数值更小时则接收缓存资源，当值为`0`时，缓存服务器会把请求转发给源服务器。当响应报文中包含`max-age`，缓存服务器不再确认资源的有效性，而以`max-age`数值作为缓存保存时长。

请求头部常使用的值介绍如下。

- `min-fresh`：数值，单位为秒。要求缓存服务器在指定的时间内返回响应。
- `only-if-cached`：客户端仅在缓存服务器本地缓存目标资源的情况下才会要求其返回值，也就是说不会向源服务器转发请求。

响应头部常使用的值介绍如下。

- `must-revalidate`：本地缓存过期前可以使用，否则必须进行有效性检验。
- `public`：响应可被任何对象缓存，没有限制。
- `private`：响应只能被特定用户缓存，不能被其他用户使用。
- `proxy-revalidate`：仅适用于共享缓存，私有缓存时忽略。

这些值虽然比较多，但是大多都是语义化的，通过单词即可猜测其大概意思，所以一般不需要强行记忆，使用时如果辨识不了再查文档即可。

### `connection`

它的常用值有两个，介绍如下。

- `Close`：当一方头部`connection`值为`Close`时，代表关闭此次连接。
- `Keep-Alive`：`HTTP/1.1`版本默认连接是持久的。对于之前的版本，需要指定值为`Keep-Alive`。

除此之外，还可以设置其他的值，比如值是`aaa`时，那么代理服务器将在转发时删除头部`aaa`字段信息。

### `date`

这是一个常用字段，很好理解，就是报文创建的时间日期。

## 请求头部字段

下面这些字段只能用于请求头部。

### `accept`

先看看一个`HTTP`请求头部`accept`字段的值，我们对照它进行分析：

`accept: text/html,application/xhtml+xml,application/xml;q=0.9,img/webp,*/*;q=0.8`

`accept`字段可以设置多个值，每个值通过逗号”`,`“分隔（而不是分号”`;`“），所以这里有`5`个值，分别是：

- `text/html`
- `application/xhtml+xml`
- `application/xml;q=0.9`
- `image/webp`
- `*/*;q=0.8`

第`1`、`2`、`4`个值的格式都为”`MIME`类型`/MIME`子类型“，`MIME`是`Multipurpose Internet Mail Extensions`（多用途因特网邮件扩展）的简称，是专门用来表示文档性质和格式的标准，浏览器通常使用`MIME`类型而不是文件扩展名来确定如何处理文档。常见的`MIME`类型与子类型如表所示。

| 类型        | 描述       | 子类型                                                       |
| ----------- | ---------- | ------------------------------------------------------------ |
| text        | 文本文件   | plain, html, css, javascript                                 |
| image       | 图片文件   | gif, png, jpeg, bmp, webp                                    |
| audio       | 音频文件   | mdi, mpeg, webm, ogg, wav                                    |
| video       | 视频文件   | webm, ogg                                                    |
| application | 二进制文件 | json, xhtml+xml, pdf, xml, x-www-form-urlencoded, octet-stream |
| multipart   | 复合文件   | form-data                                                    |

第`3`个值不但有`MIME`类型和子类型，还出现了一个`q`变量的表达式。这个表达式的含义是给当前类型赋予权重。权重值`q`的范围是`0~1`，可精确到小数点后`3`位，和`MIME`子类型通过分号”`;`“分隔，默认权重都为`1`。服务器端优先返回权重较大的类型，如果权重相等，则按照从左至右的顺序处理。后面很多其他字段值也可以用这种方式来设置权重。

第`5`个值没有指明`MIME`类型，而是用星号”`*`“作为通用匹配符，代表任意类型都可以。

上面的请求报文实例中的`accept`字段值为”`*/*`“，代表可以接收所有类型的数据，很可能是客户端没有设置`accept`而使用的默认值。

### `accept-charset`

告知服务端客户端可以处理的字符集类型，通常不需要额外设置此项，每种文件类型都有其默认的字符集类型，这个字段也支持权重设置，设置规则同`accept`。

### `accept-encoding`

客户端能够接收的编码方式，通常这个字段会是某种压缩算法，比如`gzip`、`compress`。这个字段也支持权重设置，设置规则同`accept`。

### `accept-language`

客户端可以解析的自然语言，可以一次指定多个语言并设置权重，常用的值有`zh-cn`和`en-us`。

### `authorization`

用来告知服务器端认证信息。通常会在收到`401`状态码之后，在请求头部加入此字段，它的值是：`type credentials`。

### `host`

用来告知服务器端请求资源所处的互联网主机名和端口号，如果不指定端口则会使用默认端口。这是唯一一个请求头部的必传字段。这是因为服务器在接收到请求之后会将请求中的主机名替换成`IP`地址，但是如果这时相同`IP`地址下部署了多个域名，则服务器将无法转发对应的请求。因此需要使用首部字段来明确指出请求的主机名。

### `if-modified-since`

`if-modified-since`这个字段值通常是一个日期，用来确认代理或客户端本地资源的有效性。服务器端在接收这个值后会与资源最新更新时间进行对比，如果在字段值指定的日期之后资源发生了更新，则服务器端会返回最新的资源，否则将返回`304`状态码响应客户端。

### `if-none-match`

`if-none-match`的作用和`if-modified-since`类似，用于判断本地缓存是否有效。`if-none-match`通常存储的是上一次响应头部的`ETag`值，当`if-none-match`指定的值与资源的`ETag`值不一致时，服务器端才会处理请求。

## 响应头部字段

### `age`

字段值为数值，单位为秒，该字段能告知客户端服务器端在多久前创建了响应，若创建该响应的是缓存服务器，`age`值指的是缓存后的响应再次发起认证到认证完成的时间。代理创建响应必须加上`age`字段。

### `ETag`

服务器端在每次资源更新之后，都会生成一个唯一对应的标识，这个标识就是`ETag`值。`ETag`值的生成算法由服务器端自行决定，并没有统一的要求。

`ETag`中有强`ETag`和弱`ETag`之分。强`ETag`只要资源发生变化就会改变值，而弱`ETag`值只用于提示资源是否相同，只有资源发生了较大改变的时候才会改变`ETag`值。

它们可以通过值的格式来进行区分，弱`ETag`值相对于强`ETag`值会加上`W/`来表示。

强`ETag`：`"asdfc12312"`

弱`ETag`：`W/"asdfc12312"`

### `location`

使用头部字段`location`可以引导请求发起方至某个与请求`URL`位置不同的资源，一般会配合`3xx`的状态码进行使用，比如`302`。

### `www-authenticate`

用于告知客户端当前服务器端可接收的认证方案，然后客户端可在`authentication`字段值中返回对应的值。

## 实体头部字段

实体头部字段是包含在请求报文和响应报文中的实体部分所使用的头部，用于补充与实体相关的信息。

### `allow`

用于通知客户端能够支持的`HTTP`请求方法。当服务器端接收到不支持的`HTTP`请求方法时，会响应状态信息`405 Method Not Allowed`，同时把支持的方法写入`allow`字段。

### `content-encoding`

用于告知客户端当前相应内容的编码方式，和请求头部字段`accept-encoding`的可选值一致，主要采用`4`种编码方式：`gzip`、`compress`、`deflate`、`identity`。

### `content-length`

表明实体部分的大小，单位为字节。

### `content-type`

与请求头部字段`accept`对应，表明响应实体内容的`MIME`类型。

### `last-modified`

资源的最后修改时间。同样是和缓存配合使用。

### `expires`

值为失效日期，缓存服务器在接收到含有头部字段`expires`的响应之后，会以缓存来应答请求，在`expires`值指定的日期之前，响应的值会一直被缓存，如果过期则在收到新的请求之后重新向源服务器发起请求。当头部`cache-control`值有`max-age`时，优先处理`max-age`。

## 其他头部字段

`HTTP`的头部信息是可以自定义的，服务器端和客户端都可以根据需要进行扩展。例如`X-Frame-Options`就常作为响应头部字段，用来表示网站内容是否允许被嵌入其他网站的`iframe`中。当其值为`deny`时就表示禁止被作为`iframe`嵌入，这样可以有效地防止常见的点击劫持。

