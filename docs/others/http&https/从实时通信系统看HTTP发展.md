# 从实时通信系统看`HTTP`发展

在一些监控、`Web`在线通信、即时报价系统、在线游戏等场景中，都需要将后台发生的变化主动地、实时地传送到浏览器端，而不需要用户手动地刷新页面。为了达到这个目的，应运而生了很多方案。

## 轮询

轮询是最简单无脑的方案。客户端定期发送`AJAX`请求，服务器端在受理请求后会立刻返回数据。这种方式保证了数据的相对实时性，具有很好的浏览器兼容性和简单性。但是，其缺点也很明显，比如，数据延迟取决于轮询频率，如果频率过高，就会产生大量无效请求，同时，服务器端的压力也会比较大，从而浪费带宽流量；如果频率过低，则数据的实时性就会较差。

## 长轮询

长轮询（`long-polling`）的实现思路是：客户端通过`AJAX`发起请求，服务器端在接到请求后不马上返回，而是保持这个连接，等待数据更新。当有数据需要推送给客户端时，服务器端才将目标数据发送给客户端，返回请求。客户端收到响应后，马上再发起一个新的请求给服务器端，周而复始。

这样的长轮询能够有效减少轮询次数，而且大大降低延迟，但服务器端需要保持大量连接，会产生一定的消耗。

## `Comet streaming`

`Comet streaming`技术又被称为`Forever iframe`，这种技术听上去更加巧妙，需要我们动态载入一个隐藏的`iframe`标签，`iframe`标签的`src`会指向请求的服务器地址。同时，客户端会准备好一个处理数据的函数，在服务器端通过`iframe`标签和客户端通信时，服务器端便会返回类似`script`标签的文本，客户端会将其解析为`JavaScript`脚本，并调用预先准备好的函数，将数据传递给`parent window`，类似`JSONP`的实现原理，代码如下。

```html
<script> parent.getData("data from server") </script>
```

## `AJAX multipart streaming`

`AJAX multipart streaming`用到了`HTTP 1.1`中的`multipart`特性：客户端发送请求，服务器端保持这个连接，利用`HTTP 1.1`的`chunked encoding`机制（分块传输编码）将数据传递给客户端，直到超时或客户端手动断开才停止传输。

这种方法属于遵循官方规范的方法，但是`HTTP 1.1`的`multipart`特性并没有更广泛地被浏览器支持。

## `WebSocket`

`WebSocket`是从`HTML 5`开始提供的一种在浏览器与服务器之间进行全双工通信的网络技术。依靠这种技术可以实现客户端和服务器端的长连接，进行双向实时通信。

`WebSocket`无疑是强大的，但是它也错过了浏览器为`HTTP`提供的一些服务，需要开发者在使用时自己实现，因此`WebSocket`并不能取代`HTTP`。

